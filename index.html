
<!doctype html>
<html lang="en">
<head>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="0">
    
	<meta charset="utf-8">
    
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Leaderboard for ACC using the supplied datafeed from the SwoopAPI plug-in for SimHub.">
    <meta name="author" content="Gary Rowe">
    
	<title>SwoopLeaderboard</title>
	
	<!-- Fancy Font -->
	<link href="https://fonts.googleapis.com/css2?family=Exo:wght@600&display=swap" rel="stylesheet">
    	
	<!-- Style -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.11.5/b-colvis-2.2.2/cr-1.5.5/date-1.1.2/fh-3.2.2/r-2.2.9/rg-1.1.4/sb-1.3.2/sp-2.0.0/sr-1.1.0/datatables.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://nightly.datatables.net/buttons/css/buttons.bootstrap4.min.css"/>

	<!-- CSS Flags and Car Manufacturer Icons -->
	<link href="flag-icons-main/css/flag-icons.min.css" rel="stylesheet"> 
	<link href="car-makes-icons-1.1.1/dist/style.css" rel="stylesheet">  
 
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-HM89GN1XDX"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'G-HM89GN1XDX');
	</script>
	
	<style> /* This all eventually needs moving to its own sheet */
		
		body {
		font-family: 'Exo';
		font-size: 14px;
		}

		.table-hover tbody tr:hover td, .table-hover tbody tr:hover th {
		background-color: #fff;
		color: #000;
		}
   
		.badge-outline {
		border: 1px solid #999;
		background-color: transparent;
		}
 
		.badge-outline.badge-success {
		border-color: #468847;
		}
 
		.badge-outline.badge-danger {
		border-color: #df4759;
		}
		
		.badge-outline.badge-pit {
		border-color: #ffffff;
		}

		.badge-outline.badge-platinum.text-platinum {
		border-color: #CDD5E0;
		color: #CDD5E0;
		}
		
		.badge-outline.badge-gold.text-gold {
		border-color: #C9B037;
		color: #C9B037;
		}
 
		.badge-outline.badge-silver.text-silver {
		border-color: #D7D7D7;
		color: #D7D7D7;
		}
 
		.badge-outline.badge-bronze.text-bronze {
		border-color: #CD7F32;
		color: #CD7F32;
		}
 
		.badge-outline.badge-best.text-best {
		color: #7A43B6;
		}
 
		.badge-purple {
		background-color: #6f42c1;
		color: #ffffff;
		}

		th {
		border-right: 1px solid;
		}

		.text-gold {
		color: #C9B037;
		}

		.text-silver {
		color: #D7D7D7;
		}
 
		.text-bronze {
	    color: #CD7F32;
		}

		.text-purple {
        color: #7951a8;
		}

		.dtsr-confirmation{
        color: #343a40;
		}

		.progress_bar .pro-bar {
		background: hsl(0, 0%, 97%);
		box-shadow: 0 1px 2px hsla(0, 0%, 0%, 0.1) inset;
		height:4px;
		margin-bottom: 0px; /*  12 */
		margin-top: 5px; /*  50 */
		position: relative;
		}

		.progress_bar .progress_bar_title{
		color: hsl(218, 4%, 50%);
		font-size: 15px;
		font-weight: 300;
		position: relative;
		top: -28px;
		z-index: 1;
		}
		
		.progress_bar .progress_number{
		float: right;
		margin-top: -24px;
		}

		.progress_bar .progress-bar-inner {
		background-color: hsl(0, 0%, 88%);
		display: block;
		width: 0;
		height: 100%;
		position: absolute;
		top: 0;
		left: 0;
		transition: width 1s linear 0s;
		}
		
		.progress_bar .progress-bar-inner:before {
		content: "";
		background-color: hsl(0, 0%, 100%);
		border-radius: 50%;
		width: 4px;
		height: 4px;
		position: absolute;
		right: 1px;
		top: 0;
		z-index: 1;
		}
		
		.progress_bar .progress-bar-inner:after {
		content: "";
		width: 14px;
		height: 14px;
		background-color: inherit;
		border-radius: 50%;
		position: absolute;
		right: -4px;
		top: -5px;
		}

		.nowrapping {
		white-space: nowrap;
		}
		
	</style>
</head>

<body class="bg-dark text-light">

	<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
	
		<span class="navbar-brand">Leaderboard: <span id="trackNameLoad"></span>  <span id="sessionRemainLoad"></span></span>
	
		<div class="collapse navbar-collapse" id="navbarsExampleDefault">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item">
					<a class="nav-link" data-toggle="modal" data-target="#aboutModal" href="">About</a>
				</li>
			</ul>

			<span class="navbar-text">
				<a class="nav-link" data-toggle="modal" data-target="#versionModal" href="">v 0.1.4</a>
			</span>
		</div>
    
	</nav>

<!-- Modal -->
	<div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title text-dark" id="exampleModalLabel">About</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body text-dark">
					<p class="lead">This is a Leaderboard webapp for Assetto Corsa Competizione (ACC). It has advanced conditional filtering and column visibility controls allowing you to control what you see. You can also save these layout views to quickly change between them.</p>
					<p>The Leaderboard makes use of the SwoopAPI Application which is part of the SimHub Swoop Plug-in for SimHub by David Desguin. SimHub and the Swoop Plug-in are required for this Leaderboard to function.</p>

						<div class="list-group">
							<a href="https://www.simhubdash.com/" class="list-group-item list-group-item-action flex-column align-items-start" target="blank">
								<div class="d-flex w-100 justify-content-between">
									<h5 class="mb-1">SimHub</h5>
								</div>
							</a>
							<a href="https://www.racedepartment.com/downloads/simhub-swoop-plugin.48487/updates" class="list-group-item list-group-item-action flex-column align-items-start" target="blank">
								<div class="d-flex w-100 justify-content-between">
									<h5 class="mb-1">SimHub Swoop Plug-in</h5>
									<small class="text-muted text-danger">Use API Application Required</small>
								</div>
							</a>
						</div>
		
						<br/>
						<p>This webapp was written using the Bootstrap framework and DataTables plug-in for jQuery.</p>
						<p>p.s.</p>
						<p>I am not a developer, it's only luck that this works. </p>
				</div>
				
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

<!-- Modal -->
	<div class="modal fade" id="versionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title text-dark" id="exampleModalLabel">Build Changelog</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body text-dark">
					<kbd><kbd>0.1.4</kbd></kbd><br/>
					<code>- showme URL parameter added to indicate isPlayer row colour change</code><br/>
					<kbd><kbd>0.1.3.1</kbd></kbd><br/>
					<code>- Code housekeeping</code><br/>
					<kbd><kbd>0.1.3</kbd></kbd><br/>
					<code>- Added columns for Driver Nationality </code><br/>
					<code>- Added Quick Track Position Order button </code><br/>
					<code>- Improved Driver Progress bar</code><br/>        
					<code>- General improvements to UI</code><br/>
					<kbd><kbd>0.1.2</kbd></kbd><br/>
					<code>- Now using SwoopAPI 0.6.1.2 beta</code><br/>
					<code>- Improvements to column processing</code><br/>
					<code>- Added Lap Count and Progress columns </code><br/>
					<kbd><kbd>0.1.1</kbd></kbd><br/>
					<code>- Now using SwoopAPI 0.6.1.1</code><br/>
					<code>- Improvements to column processing</code><br/>
					<code>- Improvements to UI</code><br/>
					<code>- Support for OBS added</code><br/>
					<code>- Table export functionality added</code><br/>
					<kbd><kbd>0.1.0</kbd> </kbd><br/>
					<code>- Initial Release</code>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

    <main style="padding-top:70px;padding-left:20px;padding-right:20px;"> <!-- Add a class and code this into the Style-->

		<input id="myText" type="hidden" value="" />
 
		<table id="example" class="table table-dark table-striped table-hover table-sm table-border" style="width:100%;">
			<thead>
				<tr>
					<th colspan="38"></th> <!-- Everything else!-->
					<th colspan="5">League Standings</th>
					
				</tr>
				
				<tr>
					<th colspan="1"></th> <!-- Data Interaction-->
					<th colspan="2">Position</th>
					<th colspan="8">Driver</th>
					<th colspan="2">Team</th>
					<th colspan="5">Car</th>
					<th colspan="2">Lap</th>
					<th colspan="2">Gap</th>
					<th colspan="4">Last Lap</th>
					<th colspan="6">Best Lap</th>
					<th colspan="3">Pit Stop</th>
					<th colspan="3">RA Class</th>
					<th colspan="2">Current</th>
					<th colspan="3">Provisional</th>
					
				</tr>
				
				<tr>
                	<!-- Group: (Data Interaction)-->
					<th></th>
					<!-- Group: (Position)-->
					<th>#</th>
					<th>Change</th>
					<!-- Group: (Driver)-->
					<th>Short Name</th>
					<th>Flag</th>
					<th>Nationality</th>
					<th>Number</th>
					<th>Full Name</th>
					<th>First Name</th>
					<th>Last Name</th>
					<th>Cat.</th>
					<!-- Group: (Team)-->
					<th>Name</th>
					<th>Flag</th>
					<!-- Group: (Car)-->
					<th>Logo</th>
					<th>Manufacturer</th>
					<th>Model</th>
					<th>Series</th>
					<th>Cup</th>
					<!-- Group: (Lap)-->
					<th>Count</th>
					<th>Progress</th>
					<!-- Group: (Gap)-->
					<th>Ahead</th>
					<th>To Lead</th>
					<!-- Group: (Last Lap)-->
					<th>Time</th>
					<th>Sector 1</th>
					<th>Sector 2</th>
					<th>Sector 3</th>
					<!-- Group: (Best Lap)-->
					<th>Time</th>
					<th>Sector 1</th>
					<th>Sector 2</th>
					<th>Sector 3</th>
					<th>Delta From Own</th>
					<th>Delta From Global</th>
					<!-- Group: (Pit Stop)-->
					<th>Count</th>
					<th>Laps Ago</th>
					<th>Delta</th>
					<!-- Group: (RaceApp.eu Tag -- Class)-->
					<th>Class</th>
					<th>Pos</th>
					<th>Gap</th>
					<!-- Group: (League Standings: Current)-->
					<th>Pos</th>
					<th>Pts</th>
					<!-- Group: (League Standings: Provisional)-->
					<th>Change</th>
					<th>Pos</th>
					<th>Pts</th>
					
				</tr>
			</thead>			
		</table>


		<!-- Modal: This is a spare modal to be used for the Compare feature
		================================================== -->
		<div class="modal fade" tabindex="-1" role="dialog" id="DescModal">
			<div class="modal-dialog modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title text-dark">Driver Focus</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
			
					<div class="modal-body text-dark">
						
						
					<!-- Modal content-->	
						
						
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	  
    </main><!-- /.container -->
	
	<!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
    
	<!-- Datatables
    ================================================== -->
	<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.11.5/b-2.2.2/b-colvis-2.2.2/cr-1.5.5/date-1.1.2/fh-3.2.2/r-2.2.9/rg-1.1.4/sb-1.3.2/sp-2.0.0/sr-1.1.0/datatables.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
	
	<!-- App 
    ================================================== -->
	<script>
		
	/* Formatting function for row details - modify as you need */
	function format ( d ) {
    // `d` is the original data object for the row
		return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;width=100%">'+
			'<tr>'+
				'<td>Full name:</td>'+
				'<td>'+d.currentDriver_FullName+'</td>'+
			'</tr>'+
			'<tr>'+
				'<td>Number:</td>'+
				'<td>'+d.raceNumber+'</td>'+
			'</tr>'+
			'<tr>'+
				'<td>Previous results:</td>'+
				'<td>Coming soon!</td>'+
			'</tr>'+
		'</table>';
	}
	/*
	var json = '[{"ID":"151032",  "user":"UsersName1",  "message":"This is a message.","date":"1293452007","replies":"1","categories":false,"categoriesArray":[], "lat":"0.000000000000000","lng":"0.000000000000000"},{"ID":"151033","user":"UsersName2","message":"This is another message.","date":"1293452007","replies":"2","categories":false,"categoriesArray":[],"lat":"0.000000000000000","lng":"0.000000000000000"}]';
var msgs = JSON.parse(json);

for (var i = 0, l = msgs.length; i < l; i++) {
    var msg = msgs[i];
    var div = document.createElement('div');
    div.innerHTML = 'Hello ' + msg.user + ' your Id is: ' + msg.ID + 'and your message is: ' + msg.message + ' it has ' + msg.replies + ' replies';
    document.body.appendChild(div);
}*/
	
	
	// Global var to track shown child rows
	var childRows = null;
	
	$(document).ready(function() {
	
		const queryString = window.location.search;
		
		console.log('Found the parameters that the User has set: '+queryString);
		const urlParams = new URLSearchParams(queryString);
		const mode = urlParams.get('mode');
		
		const colOrderURLParam = urlParams.get('order');
		//const showMe = urlParams.get('showme');
	 
		console.log('Mode: '+mode);
		console.log('Column Ordering by Column ID: '+colOrderURLParam);
	 
		//Check to see if there are any parameters set and if there are not then load the default string
		if (mode == null){
			window.open('https://' + location.host + location.pathname + "?mode=live&hide=0&order=1&class=&showme=","_self")
		} 
			 
		let modeSource = '';
		let modeSessionSource = '';
		
		if ( mode == 'dev') {
			modeSource = 'http://localhost:8000/AccTest/Allcars';
			modeSessionSource = 'http://localhost:8000/AccTest/GetSessionInfos';
		}
					
		else if ( mode == 'ip') {
			var ipAddress = window.prompt("Please enter the IP address of your Host machine running SimHub and the SwoopAPI:");
            modeSource = 'http://'+ ipAddress+':8000/Acc/Allcars'; 
			modeSessionSource = 'http://'+ ipAddress+':8000/Acc/GetSessionInfos'; 
        }

		else {
			modeSource = 'http://localhost:8000/Acc/Allcars'; 
			modeSessionSource = 'http://localhost:8000/Acc/GetSessionInfos';
		}
	
		function loadlink(){
			var my_json;
			$.getJSON(modeSessionSource, function(json) {
				my_json = json;
				
				
					$('#trackNameLoad').html(json.track);
					$('#sessionRemainLoad').html(json.sessionTimeLeft);
				
				
				
			});
		}
	 
	 
	$.getJSON(modeSessionSource, function (json1) {
  console.log(json1);

  $.getJSON(modeSource, function (json2) {
    console.log(json2);

    let obj = $.extend({}, json1, json2);
    console.log(obj);
  });
});
	 
		
	
	
		/* Datatable Configuration
		================================================== */
		table = $('#example').DataTable({
			
		searchBuilder: {
		},
			
		dom: 'Bfrtip',
			
		buttons: [
			{
                extend: 'searchBuilder',
		            config: {
        
					},
            },
			{
                text: 'Clear Conditions', 
				action: function ( e, dt, node, config ) { $('#example').DataTable().searchBuilder.rebuild(); }
            },

          	{
                extend: 'colvis',
				columnText: function ( dt, idx, title ) {
				return (idx)+': '+title;
            },
               	collectionLayout: 'fixed columns', //three-column // fixed columns
                collectionTitle: '<span class="text-dark"><h3>Column Visibility Control</h3></span>',
				text: 'Column Visibility',
				columns : [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42 ],
				columnText: function ( dt, idx, title ) {
					if(idx==0){ return '<small>'+(idx)+': Additional Data +</small>';}
					if(idx==1){ return '<small>'+(idx)+': Track Position</small>';}
					if(idx==2){ return '<small>'+(idx)+': Grid to Track Pos Change</small>';}
					if(idx==3){ return '<small>'+(idx)+': Driver: Short Name</small>';}
					if(idx==4){ return '<small>'+(idx)+': Driver: Nationality Flag</small>';}
					if(idx==5){ return '<small>'+(idx)+': Driver: Nationality Word</small>';}
					if(idx==6){ return '<small>'+(idx)+': Driver: Race Number</small>';}
					if(idx==7){ return '<small>'+(idx)+': Driver: Full Name</small>';}
					if(idx==8){ return '<small>'+(idx)+': Driver: First Name</small>';}
					if(idx==9){ return '<small>'+(idx)+': Driver: Last Name</small>';}
					if(idx==10){ return '<small>'+(idx)+': Driver: Category</small>';}
					if(idx==11){ return '<small>'+(idx)+': Team: Name</small>';}
					if(idx==12){ return '<small>'+(idx)+': Team: Nationality Flag</small>';}
					if(idx==13){ return '<small>'+(idx)+': Car: Logo</small>';}
					if(idx==14){ return '<small>'+(idx)+': Car: Manufacturer</small>';}
					if(idx==15){ return '<small>'+(idx)+': Car: Model</small>';}
					if(idx==16){ return '<small>'+(idx)+': Car: Series</small>';}
					if(idx==17){ return '<small>'+(idx)+': Car: Cup </small>';}
					if(idx==18){ return '<small>'+(idx)+': Lap: Total Count</small>';}
					if(idx==19){ return '<small>'+(idx)+': Lap: Track Progress Bar</small>';}
					if(idx==20){ return '<small>'+(idx)+': Gap: To Driver Ahead</small>';}
					if(idx==21){ return '<small>'+(idx)+': Gap: To Leader</small>';}
					if(idx==22){ return '<small>'+(idx)+': Last Lap: Time</small>';}
					if(idx==23){ return '<small>'+(idx)+': Last Lap: Sector 1</small>';}
					if(idx==24){ return '<small>'+(idx)+': Last Lap: Sector 2</small>';}
					if(idx==25){ return '<small>'+(idx)+': Last Lap: Sector 3</small>';}
					if(idx==26){ return '<small>'+(idx)+': Best Lap: Time</small>';}
					if(idx==27){ return '<small>'+(idx)+': Best Lap: Sector 1</small>';}
					if(idx==28){ return '<small>'+(idx)+': Best Lap: Sector 2</small>';}
					if(idx==29){ return '<small>'+(idx)+': Best Lap: Sector 3</small>';}
					if(idx==30){ return '<small>'+(idx)+': Delta: Driver Best Lap</small>';}
					if(idx==31){ return '<small>'+(idx)+': Delta: All Cars Best Lap</small>';}
					if(idx==32){ return '<small>'+(idx)+': Pit Stop: Count</small>';}
					if(idx==33){ return '<small>'+(idx)+': Pit Stop: Age</small>';}
					if(idx==34){ return '<small>'+(idx)+': Pit Stop: Delta</small>';}
					if(idx==35){ return '<small>'+(idx)+': RaceApp.eu: Tag</small>';}
					if(idx==36){ return '<small>'+(idx)+': RA.eu: Tag Pos #</small>';}
					if(idx==37){ return '<small>'+(idx)+': RA.eu: Tag Gap in Class</small>';}
					if(idx==38){ return '<small>'+(idx)+': RA.eu: Tag Current Champ Pos</small>';}
					if(idx==39){ return '<small>'+(idx)+': RA.eu: Tag Current Champ Pts</small>';}
					if(idx==40){ return '<small>'+(idx)+': RaceApp.eu: Championship Pred Change</small>';}
					if(idx==41){ return '<small>'+(idx)+': RaceApp.eu: Tag Predicted Champ Pos</small>';}
					if(idx==42){ return '<small>'+(idx)+': RaceApp.eu: Tag Predicted Champ Pts</small>';}
					//if(idx==43){ return '<small>'+(idx)+': isDriver?</small>';}

                    return (idx)+': ERROR';
                }
            },
			{
                extend: 'savedStatesCreate',
				text: 'Saved Layouts',
                collectionLayout: 'fixed columns', 
                collectionTitle: '<span class="text-dark"><h3>Manage Saved Table Layouts</h3></span>',
            },
			{
                text: 'Order by Track Pos.', 
                action: function ( e, dt, node, config ) { table.order([[1, 'asc']]).draw();}
            },
			{
                extend: 'colvisGroup',
                text: 'Show All Columns',
                show: ':hidden'
            },
			{
				extend: 'collection',
                text: 'Export',
				titleAttr: 'Exports all Columns but only visible rows.',
				buttons: [
					'copy',
                    'excel',
                	{
						extend: 'pdfHtml5',
						text: 'PDF',
						orientation: 'landscape',
						pageSize: 'A2',
						pageMargins: [ 20, 50, 20, 50 ], // [left, top, right, bottom] or [horizontal, vertical] or just a number for equal margins
					},
			    ]
            },
		], // End of buttons 

		"processing": false, 	// Need to test this to see how it works
		"select": false,
		"colReorder": false, 	// Reordering of Columsn doesn't work when you have spanned headings
		"paging":   false,		// Paging turned off so that all Drivers appear on one page
        "ordering": true,		// Column ordering is allowed
        "info":     false,		// Info turned off, I got bored of this
		"stateSave": true,		// Saving the layout of the table, columns and search etc.
		"searching": true,		// Searching is allowed
		"scrollX": true,		// Scrolling allowed as there are so many columns
		"fixedHeader": {
            header: false,
            headerOffset: $('#navbar').outerHeight()
		},
		"language": {
			searchBuilder: {
				button: 'Conditional Filtering',
				add: 'Add Condition',
				condition: 'Condition',
				clearAll: 'Clear All Conditions',
				delete: 'Delete Condition',
				deleteTitle: 'Delete Title',
				data: 'Column',
				left: 'Remove Nested Condition',
				//leftTitle: 'Left Title',
				logicAnd: 'AND',
				logicOr: 'OR',
				right: 'Add Nested Condition',
				//rightTitle: 'Right Title',
				title: {
					0: 'Conditional Filtering',
					_: 'Filters applied to Drivers Table ( %d )'
				},
				value: 'Option',
				valueJoiner: 'et'
			},
			"zeroRecords": "No Drivers Found",
			"info": "Showing _MAX_ Drivers",
			"infoEmpty": "No Drivers Found",
			"search": "Quick Global Filter",
        },
		
		"ajax": {
			"url": modeSource, // Source set from the ?mode= parameter in the URL. Current options are 'live' or 'ip'
			"dataSrc": ""
        },
		  
		"columns": [
			{
				"className":      'dt-control',
/* id=0 */		"data":           null, // This column is for the child expanding data
				"defaultContent": ''
			},
/* id=1 */	{ 'data': 'racePosition' },
/* id=2 */	{ "data": "movements" ,
				render: function(data, type) {
					if (type === 'display') {
						let directionMove = "";
							if (data[0] >= '+1' ) {
								directionMove = "<span class=text-danger>&#9660;</span>"; // Position change red, you've dropped places!
							}
							else if (data[0] < '0' ) {
								directionMove = "<span class=text-success>&#9650;</span>"; // Position change green, you've overtaken cars!
							}
							else {
								directionMove = "<span class=text-primary>&#9655;</span> 0"; // Position change static, you've maintained track position!
							}
						return '' + directionMove + ' ' + data + '';
					}
				return data;
				}
			},
/* id=3 */	{ 'data': 'currentDriver_ShortName' }, 
/* id=4 */	{ "data": "currentDriver_NationalityNumber" ,
				"render": function (data, type, row) {
					if ( row['currentDriver_NationalityNumber'] == '0') { return '';}
					else if ( row['currentDriver_NationalityNumber'] == '1') { return '<span class="fi fi-it"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '2') { return '<span class="fi fi-de"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '3') { return '<span class="fi fi-fr"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '4') { return '<span class="fi fi-es"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '5') { return '<span class="fi fi-gb"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '6') { return '<span class="fi fi-hu"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '7') { return '<span class="fi fi-be"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '8') { return '<span class="fi fi-ch"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '9') { return '<span class="fi fi-at"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '10') { return '<span class="fi fi-ru"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '11') { return '<span class="fi fi-th"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '12') { return '<span class="fi fi-nl"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '13') { return '<span class="fi fi-pl"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '14') { return '<span class="fi fi-ar"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '15') { return '<span class="fi fi-mc"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '16') { return '<span class="fi fi-ie"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '17') { return '<span class="fi fi-br"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '18') { return '<span class="fi fi-za"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '19') { return '<span class="fi fi-pr"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '20') { return '<span class="fi fi-sk"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '21') { return '<span class="fi fi-om"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '22') { return '<span class="fi fi-gr"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '23') { return '<span class="fi fi-sa"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '24') { return '<span class="fi fi-no"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '25') { return '<span class="fi fi-tr"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '26') { return '<span class="fi fi-kr"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '27') { return '<span class="fi fi-lb"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '28') { return '<span class="fi fi-am"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '29') { return '<span class="fi fi-mx"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '30') { return '<span class="fi fi-se"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '31') { return '<span class="fi fi-fi"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '32') { return '<span class="fi fi-dk"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '33') { return '<span class="fi fi-hr"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '34') { return '<span class="fi fi-ca"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '35') { return '<span class="fi fi-cn"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '36') { return '<span class="fi fi-pt"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '37') { return '<span class="fi fi-sg"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '38') { return '<span class="fi fi-id"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '39') { return '<span class="fi fi-us"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '40') { return '<span class="fi fi-nz"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '41') { return '<span class="fi fi-au"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '42') { return '<span class="fi fi-sm"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '43') { return '<span class="fi fi-ae"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '44') { return '<span class="fi fi-lu"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '45') { return '<span class="fi fi-kw"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '46') { return '<span class="fi fi-hk"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '47') { return '<span class="fi fi-co"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '48') { return '<span class="fi fi-jp"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '49') { return '<span class="fi fi-ad"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '50') { return '<span class="fi fi-az"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '51') { return '<span class="fi fi-bg"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '52') { return '<span class="fi fi-cu"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '53') { return '<span class="fi fi-cz"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '54') { return '<span class="fi fi-ee"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '55') { return '<span class="fi fi-ge"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '56') { return '<span class="fi fi-in"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '57') { return '<span class="fi fi-il"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '58') { return '<span class="fi fi-jm"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '59') { return '<span class="fi fi-lv"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '60') { return '<span class="fi fi-lt"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '61') { return '<span class="fi fi-mo"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '62') { return '<span class="fi fi-my"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '63') { return '<span class="fi fi-np"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '64') { return '<span class="fi fi-nc"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '65') { return '<span class="fi fi-ne"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '66') { return '<span class="fi fi-gb-nir"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '67') { return '<span class="fi fi-pg"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '68') { return '<span class="fi fi-ph"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '69') { return '<span class="fi fi-qa"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '70') { return '<span class="fi fi-ro"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '71') { return '<span class="fi fi-gb-sct"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '72') { return '<span class="fi fi-rs"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '73') { return '<span class="fi fi-si"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '74') { return '<span class="fi fi-tw"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '75') { return '<span class="fi fi-ua"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '76') { return '<span class="fi fi-ve"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '77') { return '<span class="fi fi-gb-wls"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '78') { return '<span class="fi fi-ir"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '79') { return '<span class="fi fi-bh"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '80') { return '<span class="fi fi-zw"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '81') { return '<span class="fi fi-xx"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '82') { return '<span class="fi fi-cl"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '83') { return '<span class="fi fi-uy"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '84') { return '<span class="fi fi-mg"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '85') { return '<span class="fi fi-mt"></span>';}
					else if ( row['currentDriver_NationalityNumber'] == '86') { return '<span class="fi fi-gb-eng"></span>';}
					else { return '';}
				}
			},
/* id=5 */	// { 'data': 'currentDriver_Nationality' },
/* id=5 */	{ 'data': null,"defaultContent": '' }, // Testing spacing of Nationality

/* id=6 */	{ 'data': 'raceNumber' }, 

/* id=7 */	// { 'data': 'currentDriver_FullName' }, 
/* id=7 */	{ 'data': null,"defaultContent": '' }, // Testing capitalising the fullname

/* id=8 */	{ 'data': 'currentDriver_FirstName'	},	
/* id=9 */	{ 'data': 'currentDriver_LasttName' }, 
/* id=10 */	{ 'data': 'driverCategory' , 
				"render": function (data, type, row) {
					if ( row['driverCategory'] == '0') { return '<span class="badge text-bronze badge-outline badge-bronze">BRONZE</span>';}
					else if ( row['driverCategory'] == '1') { return '<span class="badge text-silver badge-outline badge-silver">SILVER</span>';}
					else if ( row['driverCategory'] == '2') { return '<span class="badge text-gold badge-outline badge-gold">GOLD</span>';}
					else if ( row['driverCategory'] == '3') { return '<span class="badge text-platinum badge-outline badge-platinum">PLATINUM</span>';}
					else { return 'Error';}
				}
			},
/* id=11 */ { 'data': 'teamName' }, 
/* id=12 */ //{ 'data': 'teamNationality' }, 
/* id=12 */	{ 'data': null,"defaultContent": '' }, // Testing spacing of Nationality

/* id=13 */ { "data": "carBrand" , 
				"render": function (data, type, row) {
					if ( row['carBrand'] == 'Mercedes-AMG') { return '<span class="car-mercedes-benz"></span>';}
					else if ( row['carBrand'] == 'Honda') { return '<span class="car-honda"></span>';}
					else if ( row['carBrand'] == 'McLaren') { return '<span class="car-mclaren"></span>';}
					else if ( row['carBrand'] == 'Audi') { return '<span class="car-audi"></span>';}
					else if ( row['carBrand'] == 'Porsche') { return '<span class="car-porsche"></span>';}
					else if ( row['carBrand'] == 'Lamborghini') { return '<span class="car-lamborghini"></span>';}
					else if ( row['carBrand'] == 'Mercedes') { return '<span class="car-mercedes-benz"></span>';}
					else if ( row['carBrand'] == 'Aston') { return '<span class="car-aston-martin"></span>';}
					else if ( row['carBrand'] == 'Lexus') { return '<span class="car-lexus"></span>';}
					else if ( row['carBrand'] == 'BMW') { return '<span class="car-bmw"></span>';}
					else if ( row['carBrand'] == 'Ginetta') { return '';}
					else if ( row['carBrand'] == 'KTM') { return '';}
					else if ( row['carBrand'] == 'Chevrolet') { return '<span class="car-chevrolet"></span>';}
					else if ( row['carBrand'] == 'Alpine') { return '';}
					else if ( row['carBrand'] == 'Maserati') { return '<span class="car-maserati"></span>';}
					else if ( row['carBrand'] == 'Ferrari') { return '<span class="car-ferrari"></span>';}
					else if ( row['carBrand'] == 'Nissan') { return '<span class="car-nissan"></span>';}
					else if ( row['carBrand'] == 'Ferrari') { return '<span class="car-ferrari"></span>';}
					else if ( row['carBrand'] == 'Bentley') { return '<span class="car-bentley"></span>';}
					else if ( row['carBrand'] == 'Jaguar') { return '<span class="car-jaguar"></span>';}
					else if ( row['carBrand'] == 'Reiter') { return '';}
					else { return '';}
				}
			//https://garyrowe.co.uk/acc/car-makes-icons-1.1.1/dist/demo.html			
			},					
/* id=14 */ { 'data': 'carBrand' }, 
/* id=15 */ { 'data': 'carName' }, 
/* id=16 */ { "data": "serie" , 
				"render": function (data, type, row) {
					if ( row['serie'] == '0') { return '<span class="badge badge-dark">GT3</span>';} //GT3
					else if ( row['serie'] == '1') { return '<span class="badge badge-purple">GT4</span>';} //GT4
					else if ( row['serie'] == '2') { return '<span class="badge badge-danger">CHL</span>';} //CHL
					else if ( row['serie'] == '3') { return '<span class="badge badge-warning">ST</span>';} //ST
					else if ( row['serie'] == '4') { return '<span class="badge badge-success">CUP</span>';} //CUP
					else if ( row['serie'] == '5') { return '<span class="badge badge-primary">TCX</span>';} //TCX
					else if ( row['serie'] == '299') { return '?';} //NONE
					else { return 'Error';}
				}
			},
/* id=17 */ { "data": "cupCategory" , 
				"render": function (data, type, row) {
					if ( row['cupCategory'] == '0') { return '<span class="badge badge-light">PRO</span>';} //Pro
					else if ( row['cupCategory'] == '1') { return '<span class="badge badge-dark">PRO-AM</span>';} //ProAm
					else if ( row['cupCategory'] == '2') { return '<span class="badge badge-danger">AM</span>';} //Am
					else if ( row['cupCategory'] == '3') { return '<span class="badge text-dark badge-light">SILVER</span>';} //Silver
					else if ( row['cupCategory'] == '4') { return '<span class="badge text-dark badge-light">NATIONAL</span>';} //National
					else { return 'Error';}
				}
			},
/* id=18 */	{ 'data': 'laps' }, 
/* id=19 */	{ 'data': null,"defaultContent": '' }, // Progress bar
/* id=20 */	//{ 'data': 'gap' }, 
/* id=21 */	//{ 'data': 'gapToLeader' }, 

/* id=20 */	{ 'data': null,"defaultContent": '' }, // Progress bar
/* id=21 */	{ 'data': null,"defaultContent": '' }, // Progress bar

/* id=22 */	{ 'data': 'lastLapTime' }, 
/* id=23 */	{ 'data': 'lastLapSector1' }, 
/* id=24 */	{ 'data': 'lastLapSector2' }, 
/* id=25 */	{ 'data': 'lastLapSector3' }, 
/* id=26 */	{ 'data': null,"defaultContent": '' }, // this is the bestLapTime column but needs processing on it for IS GLOBAL BEST
/* id=27 */	{ 'data': 'bestSector1' }, 
/* id=28 */	{ 'data': 'bestSector2' }, 
/* id=29 */	{ 'data': 'bestSector3' }, 
/* id=30 */	//{ 'data': 'deltaFromBestLap' }, 
/* id=30 */	{ 'data': null,"defaultContent": '' }, // Progress bar

/* id=31 */	//{ 'data': 'deltaFromAllCarsBestLap' }, 
/* id=31 */	{ 'data': null,"defaultContent": '' }, // Progress bar


/* id=32 */	{ 'data': null,"defaultContent": '' }, // RaceApp Tag
/* id=33 */	{ 'data': null,"defaultContent": '' },
/* id=34 */	{ 'data': 'inPitSince' }, 
/* id=35 */	{ "data": "raceAppTag" ,
				"render": function (data, type, row) {
					if ( row["raceAppTag"] == 'SILVER') {
						return '<span class="badge text-silver badge-outline badge-silver">SILVER</span>';}
					else if ( row["raceAppTag"] == 'BRONZE') {
						return '<span class="badge text-bronze badge-outline badge-bronze">BRONZE</span>';} 
					else if ( row["raceAppTag"] == 'GOLD') {
						return '<span class="badge text-gold badge-outline badge-gold">GOLD</span>';} 
					else if ( row["raceAppTag"] == 'PLATIN') {
						return '<span class="badge text-platinum badge-outline badge-platinum">PLATINUM</span>';} 
					else { return '<span class="badge badge-outline badge-danger">NOT FOUND</span>';} 
				}
			},
/* id=36 */	{ 'data': 'raceAppTagPosition' }, 
/* id=37 */	{ 'data': null,"defaultContent": '' }, // Gap within RaceApp Class
/* id=38 */	{ "data": "raceAppByTagChampionshipPosition" ,
				"render": function (data, type, row) {
					if ( row["raceAppByTagChampionshipPosition"] == '1') {
						return '1 <i class="fa-solid fa-trophy text-gold"></i>';}
					else if ( row["raceAppByTagChampionshipPosition"] == '2') {
						return '2 <i class="fa-solid fa-trophy text-silver"></i>';}		
					else if ( row["raceAppByTagChampionshipPosition"] == '3') {
						return '3 <i class="fa-solid fa-trophy text-bronze"></i>';}
					else { return row["raceAppByTagChampionshipPosition"];} 
				}
			},	
/* id=39 */	{ 'data': 'raceAppByTagChampionshipTotalPoints' }, 
/* id=40 */	{ 'data': null,"defaultContent": '' }, // this is the change
/* id=41 */	{ "data": "raceAppByTagChampionshipPredictedPosition" , 
				"render": function (data, type, row) {
					if ( row["raceAppByTagChampionshipPredictedPosition"] == '1') {
						return '1 <i class="fa-solid fa-trophy text-gold"></i>';}
					else if ( row["raceAppByTagChampionshipPredictedPosition"] == '2') {
						return '2 <i class="fa-solid fa-trophy text-silver"></i>';}		
					else if ( row["raceAppByTagChampionshipPredictedPosition"] == '3') {
						return '3 <i class="fa-solid fa-trophy text-bronze"></i>';}
					else { return row["raceAppByTagChampionshipPredictedPosition"];} 
				}
			},	
/* id=42 */	{ 'data': 'raceAppByTagChampionshipPredictedPoints' }, 


        ],

		"order": [colOrderURLParam, 'asc'],

		"columnDefs": [
			{ className: "nowrapping", "targets": [ 3,7,8,9,11,12,15,21,23,24,25,27,28,29,30,31,33,37 ] }, //UPDATE TARGET

		/*	{
				searchBuilderTitle: '',
				targets: [] //UPDATE TARGET
			},
			{
				searchBuilderTitle: '',
				targets: [] //UPDATE TARGET
			},
			{
				searchBuilderTitle: '',
				targets: [] //UPDATE TARGET
			},
			{
				searchBuilderTitle: '',
				targets: [] //UPDATE TARGET
			},
			{
				searchBuilderTitle: '',
				targets: [] //UPDATE TARGET
			},
			{
				searchBuilderTitle: '',
				targets: [] //UPDATE TARGET
			}, */
			{
				searchBuilderTitle: 'RaceApp.eu Driver Tag (Class)',
				targets: [35] //UPDATE TARGET
			},
			{
				searchBuilderTitle: 'RaceApp.eu Position within Driver Tag (Class)',
				targets: [36] //UPDATE TARGET
			},
			{ "orderable": false, "targets": [0] },
		
			{"render": function ( data, type, row ) {
				var sum1 = row['raceAppByTagChampionshipPosition'];
				var sum2 = row['raceAppByTagChampionshipPredictedPosition'];
				var theAnswer = sum1 - sum2;
			
				if (type === 'display') {
					if (theAnswer >= '+1' ) {
						championshipChange = "<span class=text-success>&#9650;</span> +" + theAnswer; // Position change red, you've dropped places!
					}
					else if (theAnswer < '0' ) {
						championshipChange = "<span class=text-danger>&#9660;</span> " + theAnswer; // Position change gree, you've overtaken cars!
					}
					else {
						championshipChange = "<span class=text-primary>&#9655;</span> " + theAnswer; // Position change static, you've maintained track position!
					}
					return '' + championshipChange + '';
				}
				return data;
			},
			"targets": 40 //UPDATE TARGET
			},
			{"render": function ( data, type, row ) {
				var bestTime = row['bestLapTime'];
				var areYouTheBest = row['haveAllBestLapTime'];
			
				if (type === 'display') {
					if (areYouTheBest >= '1' ) {
						bestMarker = "<span class='text-purple'>" + bestTime + "</span>"; // Global best goes purple!
					}
					else {
						bestMarker = bestTime; // Position change static, you've maintained track position!
					}
					return '' + bestMarker + '';
				}
				return data;
			},
			"targets": 26 //UPDATE TARGET
			},
			{"render": function ( data, type, row ) {
				var pitStopCountForD = row['pitStopCount'];
				var areTheyPitting = row['isPiting'];
				var pittingTimer = row['inPitSince'];
			
				if (type === 'display') {
					if (areTheyPitting >= '1' ) {
						let number = parseInt(pitStopCountForD, 10)
						pitColMsg = number + 1; // Position change red, you've dropped places!
					}
					else {
						pitColMsg = pitStopCountForD; // Position change static, you've maintained track position!
					}
					return '' + pitColMsg + '';
				}
				return data;	
			},
			"targets": 32 //UPDATE TARGET
			},
			
			{"render": function ( data, type, row ) {
				
				var splinePercent = row['splinePosition'] * 100 ;
				var notMoving = row['isPiting'];
				var isItMe = row['isPlayer'];
				var sectOne = row['currentSector1Status'];
				var sectTwo = row['currentSector2Status'];
				var sectThree = row['currentSector3Status'];
					
				var sectOneCol = "";
				var sectTwoCol = "";
				var sectThreeCol = "";
				
				if ( row['currentSector1Status'] == '0') { sectOneCol = '292b2c';}
				else if ( row['currentSector1Status'] == '1') { sectOneCol = 'd9534f';}
				else if ( row['currentSector1Status'] == '2') { sectOneCol = 'f0ad4e';}
				else if ( row['currentSector1Status'] == '3') { sectOneCol = '5cb85c';}
				else { sectOneCol = '7951a8';} //4

				if ( row['currentSector2Status'] == '0') { sectTwoCol = '292b2c';}
				else if ( row['currentSector2Status'] == '1') { sectTwoCol = 'd9534f';}
				else if ( row['currentSector2Status'] == '2') { sectTwoCol = 'f0ad4e';}
				else if ( row['currentSector2Status'] == '3') { sectTwoCol = '5cb85c';}
				else { sectOneCol = '7951a8';} //4

				if ( row['currentSector3Status'] == '0') { sectThreeCol = '292b2c';}
				else if ( row['currentSector3Status'] == '1') { sectThreeCol = 'd9534f';}
				else if ( row['currentSector3Status'] == '2') { sectThreeCol = 'f0ad4e';}
				else if ( row['currentSector3Status'] == '3') { sectThreeCol = '5cb85c';}
				else { sectOneCol = '7951a8';} //4

				/*	
				None = 0,
				Invalid = 1,
				Slower = 2,
				Best = 3,
				OverallBest = 4
				*/	

				if (type === 'display') {
			
					/*if (isItMe >= '1' ) {

						if (notMoving >= '1' ) {
							return '<div class="progress_bar" style="width: 300px;"><div class="pro-bar"><span class="progress-bar-inner" style="background-color: #d9534f; width: ' + Math.trunc(splinePercent) + '%;" data-value="' + Math.trunc(splinePercent) + '" data-percentage-value="' + Math.trunc(splinePercent) + '"></span></div></div>'+
							'<br/>'+
							'<div class="progress_bar" style="width: 300px;height:5px">'+
							'<div class="progress-bar" style="background-color: #' + sectOneCol + '; width:33.33%">'+
							//	'Sector 1'+
							'</div>'+
							'<div class="progress-bar" style="background-color: #' + sectTwoCol + '; width:33.33%">'+
							//	'Sector 2'+
							'</div>'+
							'<div class="progress-bar" style="background-color: #' + sectThreeCol + '; width:33.33%">'+
							//	'Sector 3'+
							'</div>'+
							'</div>'
							}
									
						else {
							return '<div class="progress_bar"><div class="pro-bar"><span class="progress-bar-inner" style="background-color: #5cb85c; width: ' + Math.trunc(splinePercent) + '%;" data-value="' + Math.trunc(splinePercent) + '" data-percentage-value="' + Math.trunc(splinePercent) + '"></span></div></div>'+
							'<br/>'+
							'<div class="progress_bar" style="width: 300px;height:5px">'+
							'<div class="progress-bar" style="background-color: #' + sectOneCol + '; width:33.33%">'+
							//	'Sector 1'+
							'</div>'+
							'<div class="progress-bar" style="background-color: #' + sectTwoCol + '; width:33.33%">'+
							//	'Sector 2'+
							'</div>'+
							'<div class="progress-bar" style="background-color: #' + sectThreeCol + '; width:33.33%">'+
							//	'Sector 3'+
							'</div>'+
							'</div>'
						}
					}
									
					else { */
						if (notMoving >= '1' ) {
							return '<div class="progress_bar" style="width: 300px;"><div class="pro-bar"><span class="progress-bar-inner" style="background-color: #d9534f; width: ' + Math.trunc(splinePercent) + '%;" data-value="' + Math.trunc(splinePercent) + '" data-percentage-value="' + Math.trunc(splinePercent) + '"></span></div></div>'
						}
						else {
							return '<div class="progress_bar" style="width: 300px;"><div class="pro-bar"><span class="progress-bar-inner" style="background-color: #5cb85c; width: ' + Math.trunc(splinePercent) + '%;" data-value="' + Math.trunc(splinePercent) + '" data-percentage-value="' + Math.trunc(splinePercent) + '"></span></div></div>'
						}
					//}
					return 'error'
				}
				return data;
			},
			"targets": 19 //UPDATE TARGET
			},
		
			{"render": function ( data, type, row ) {
				var lastStopAge = row['lapsFromLastPitStop'];
				return lastStopAge;
			},
			"targets": 33 //UPDATE TARGET
			},
			
			{"render": function ( data, type, row ) {
				var capFullname = row['currentDriver_FullName'];
				return capFullname.toUpperCase();
			},
			"targets": 7 //UPDATE TARGET
			},
			
			{"render": function ( data, type, row ) {
				var nationSpace = row['currentDriver_Nationality'];	
				if (nationSpace == "Any" || nationSpace == null || nationSpace == "" ){
				return "";
			} 
				return nationSpace.replace(/[A-Z]/g, ' $&').trim();
				
			},
			"targets": 5 //UPDATE TARGET
			},
			
			{"render": function ( data, type, row ) {
			var teamSpace = row['teamNationality'];
			
				if (teamSpace = "Any"){
				return "";
			} 
			else if (teamSpace = ""){
							return "";
						}
						
				return teamSpace.replace(/[A-Z]/g, ' $&').trim();
				
			},
			"targets": 12 //UPDATE TARGET
			}, 
			
			{"render": function ( data, type, row ) {
			var timeFormatA = row['gap'];
			if (timeFormatA == null){
				return timeFormatA;
			} 
				return timeFormatA.replace(/'/g, '.');
			},
			"targets": 20 //UPDATE TARGET
			},
			
			{"render": function ( data, type, row ) {
			var timeFormatB = row['gapToLeader'];
			if (timeFormatB == null){
				return timeFormatB;
			} 
				return timeFormatB.replace(/'/g, '.');
			},
			"targets": 21 //UPDATE TARGET
			},
			
			{"render": function ( data, type, row ) {
			var timeFormatC = row['deltaFromBestLap'];
			if (timeFormatC == null){
				return timeFormatC;
			} 
				return timeFormatC.replace(/'/g, '.');
			},
			"targets": 30 //UPDATE TARGET
			},
			
			{"render": function ( data, type, row ) {
			var timeFormatD = row['deltaFromAllCarsBestLap'];
			if (timeFormatD == null){
				return timeFormatD;
			} 
				return timeFormatD.replace(/'/g, '.');
			},
			"targets": 31 //UPDATE TARGET
			},
			
			
			{"render": function ( data, type, row ) {
				return "sum";
				/*
				
					This is where the code will go to calculate the gap between players in the same RaceApp Class
				
				*/
			},
			"targets": 37 //UPDATE TARGET
			},
			
			
		],
	
	"createdRow": function( row, data ) {        
		/*
		
			URL parameter trigger:
			showme=0
			showme=1    this will show the line you are on
		
		*/
		const showMe = urlParams.get('showme');
	//	console.log("Show me setting from URL: "+showMe);
		
		$(function(){
			//var s = "jpeg, jpg, gif, png";
			var match = showMe.split(',')
			console.log(match)
			for (var a in match)
				{
				var variable = match[a]
				console.log(variable)
				
				if ( data['raceNumber'] == variable ) {      
				$(row).addClass('bg-light text-dark');
			}  
				
				
				}
		})
		
		
		/*
		if ( showMe == "1") { 
			if ( data['isPlayer'] === 1 ) {      
				$(row).addClass('bg-light text-dark');
			}  
		}
		*/
     
    },
	
	/*
	
	This is the code for indicating where you'll exit the pits in the leaderboard.
	
	"drawCallback": function( settings ) {
    // isPlayer
	// lastDriveThroughTime   =   time driving through, stopping and exiting the pit lane 
	// gapToLeader	
	
	var api = this.api();
	
    console.log( api.rows( {page:'current'} ).data() );
	
	var tabledata = api.rows( {page:'current'} ).data();
	console.log(tabledata);
	tabledata.forEach((row) => {
		if ( row.isPlayer ) {
			console.log("hello");
		}
	});
		
    }*/
	

 	}); // End of DataTable $('#example').DataTable({
	
	const queryStringForHide = window.location.search;
	const urlParamsHide = new URLSearchParams(queryStringForHide);
	const hiddenCols = urlParamsHide.get('hide');
	const classFiltering = urlParamsHide.get('class');
	console.log('Hiding Columns: '+hiddenCols);

	table.columns([''+hiddenCols+'']).visible(false);

	//classFiltering
	document.getElementById("myText").value = classFiltering;
	table.columns(35).search( $('#myText').val() ).draw(); //UPDATE TARGET COLUMN
	
	// Add event listener for opening and closing details
    $('#example tbody').on('click', 'td.dt-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );
 
        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );
		
	$('button').on('click', function () {
		// Get shown rows
		childRows = table.rows($('.shown'));
		table.ajax.reload();
	});

	table.on('draw', function () {
		// If reloading table then show previously shown rows
		if (childRows) {
			childRows.every(function ( rowIdx, tableLoop, rowLoop ) {
			d = this.data();
			this.child($(format(d))).show();
			this.nodes().to$().addClass('shown');
			} );
		// Reset childRows so loop is not executed each draw
		childRows = null;
		}
	});
	
	// This adds the bg-dark class to the fixedHeader
	var elements = document.getElementsByClassName("sorting");
	for(var i = 0; i < elements.length; i++){
    elements[i].className += " bg-dark";
	}
	
	setInterval(function() {
		childRows = table.rows($('.shown'));
		table.ajax.reload();
		loadlink();
	}, 600 );
	
	}); // end of $(document).ready(function () {

	</script>
	
	<script src="https://kit.fontawesome.com/b439db3590.js" crossorigin="anonymous"></script>

</body>
</html>
